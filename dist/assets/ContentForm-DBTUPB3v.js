import{r as l,D as B,u as V,j as e,L as Y,E as Z,b,v as p,n as z,p as h,i as _,w as G,l as J,m as M}from"./index-C_4GKcXO.js";import{u as Q}from"./index.esm-D2pPP2Os.js";import{B as W}from"./index-DOc7TYCd.js";import{S as X}from"./Saving-DKPS-b8t.js";import{S as K}from"./SuccessNotification-BAm-q0VH.js";const oe=()=>{var N,k;const{register:n,handleSubmit:C,watch:D,setValue:a,setError:F,clearErrors:ee,formState:{errors:d}}=Q(),[I,y]=l.useState(!1),[E,R]=l.useState(!0),[A,v]=l.useState(!1),[L,S]=l.useState(!1),[o,g]=l.useState({imageSection:!0,videoSection:!1,articleSection:!1}),w=B(),P=V(),s=(N=w.state)==null?void 0:N.item,u=(k=w.state)==null?void 0:k.type,f=D("imageFile"),[j,x]=l.useState({});l.useEffect(()=>{if(f&&f.length>0){const t=Array.from(f),i=[];return t.forEach((r,c)=>{const m=new FileReader;m.onload=q=>{x(O=>({...O,[c]:q.target.result}))},m.readAsDataURL(r),i.push(m)}),()=>{i.forEach(r=>r.abort())}}else x(null)},[f]),l.useEffect(()=>{const t=setTimeout(()=>R(!1),1e3);return()=>clearTimeout(t)},[]),l.useEffect(()=>{s&&(u==="imageContent"?(a("category",s.category),a("imageDetails",s.imageDetails),x(s.imageUrl),g({imageSection:!0,videoSection:!1,articleSection:!1})):u==="videoContent"?(a("category",s.category),a("videoUrl",`https://www.youtube.com/watch?v=${s.videoUrl}`),a("videoDetails",s.videoDetails),g({imageSection:!1,videoSection:!0,articleSection:!1})):u==="articleContent"&&(a("category",s.category),a("articleUrl",s.articleUrl),a("articleHeading",s.articleHeading),s.articleImageUrl&&x(s.articleImageUrl),g({imageSection:!1,videoSection:!1,articleSection:!0})))},[s,u,a]);const $=t=>{g(i=>({imageSection:!1,videoSection:!1,articleSection:!1,[t]:!i[t]}))},U=async t=>{const r=Array.from(t).map(c=>{const m=_(G,`contentImages/${c.name}`);return J(m,c).then(()=>M(m))});return Promise.all(r)},T=t=>{const i=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/i,r=t.match(i);return r?r[1]:null},H=async t=>{console.log("Form data: ",t),y(!0);try{if(o.videoSection){const r=T(t.videoUrl);if(!r){F("videoUrl",{type:"manual",message:"Please enter a valid YouTube video link."}),y(!1);return}t.videoUrl=r}const i={category:t.category||""};if(o.imageSection&&t.imageFile){const r=await U(t.imageFile);i.imageUrls=r,i.imageDetails=t.imageDetails||""}if(o.videoSection&&t.videoUrl&&(i.videoUrl=t.videoUrl,i.videoDetails=t.videoDetails||""),o.articleSection&&t.articleUrl&&(i.articleUrl=t.articleUrl,i.articleHeading=t.articleHeading||"",t.articleImage.length>0&&(i.articleImageUrl=await U(t.articleImage[0]))),s){const r=b(p,`${u}/${s.id}`);await z(r,i)}else o.imageSection&&t.imageFile&&await h(b(p,"imageContent"),i),o.videoSection&&t.videoUrl&&await h(b(p,"videoContent"),i),o.articleSection&&t.articleUrl&&await h(b(p,"articleContent"),i);v(!0),setTimeout(()=>P("/admin/forms/gallery"),2e3)}catch(i){console.error("Error submitting content: ",i),S(!0)}finally{y(!1)}};return E?e.jsx(Y,{}):e.jsxs(e.Fragment,{children:[I&&e.jsx(X,{}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex flex-col space-y-2 p-6 bg-gray-200",children:Object.entries(o).map(([t,i])=>e.jsxs("button",{onClick:()=>$(t),className:`py-2 px-4 rounded transition duration-300 flex items-center gap-2 ${i?"bg-red-500 hover:bg-red-700":"bg-blue-500 hover:bg-blue-700"} text-white`,children:[e.jsx(W,{}),t.replace(/([A-Z])/g," $1").replace("Section"," Section")]},t))}),e.jsxs("form",{onSubmit:C(H),className:"p-6 bg-white shadow-lg rounded-lg flex-grow space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-indigo-600",children:s?"Edit Content":"Upload Content"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Category"}),e.jsx("input",{type:"text",...n("category"),className:"mt-1 block w-full pl-3 py-2 text-base text-gray-900 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),Object.entries(o).map(([t,i])=>i&&e.jsxs("div",{children:[t==="imageSection"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Image File ",s?"":e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"file",...n("imageFile",{required:s?!1:"Image file is required"}),multiple:!0,className:"mt-1 block w-full pl-3 py-2 text-base text-gray-900 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"}),d.imageFile&&e.jsx("p",{className:"text-red-500 text-xs italic",children:d.imageFile.message}),j&&Object.values(j).map((r,c)=>e.jsx("img",{src:r,alt:`Preview ${c}`,className:"mt-4 h-48 w-auto border rounded-md"},c)),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mt-2",children:"Image Details"}),e.jsx("textarea",{...n("imageDetails"),className:"mt-1 block w-full pl-3 py-2 text-base text-gray-900 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),t==="videoSection"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Video URL ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"url",...n("videoUrl",{required:"Please enter a valid YouTube video link."}),className:"mt-1 block w-full pl-3 py-2 text-base text-gray-900 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"}),d.videoUrl&&e.jsx("p",{className:"text-red-500 text-xs italic",children:d.videoUrl.message}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mt-2",children:"Video Details"}),e.jsx("textarea",{...n("videoDetails"),className:"mt-1 block w-full pl-3 py-2 text-base text-gray-900 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),t==="articleSection"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Article URL ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"url",...n("articleUrl",{required:"Article URL is required"}),className:"mt-1 block w-full pl-3 py-2 text-base text-gray-900 border border-gray-300 rounded-md shadow-sm  focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"}),d.articleUrl&&e.jsx("p",{className:"text-red-500 text-xs italic",children:d.articleUrl.message}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mt-2",children:"Article Heading"}),e.jsx("input",{type:"text",...n("articleHeading"),className:"mt-1 block w-full pl-3 py-2 text-base text-gray-900 border border-gray-300 rounded-md shadow-sm  focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mt-2",children:"Article Image"}),e.jsx("input",{type:"file",...n("articleImage"),className:"mt-1 block w-full pl-3 py-2 text-base text-gray-900 border border-gray-300 rounded-md shadow-sm  focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]})]},t)),A&&e.jsx(K,{message:"Content submitted successfully!",onClose:()=>v(!1)}),L&&e.jsx(Z,{message:"Failed to submit content!",onClose:()=>S(!1)}),e.jsx("button",{type:"submit",className:"w-full bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded",children:s?"Update Content":"Submit Content"})]})]})]})};export{oe as default};
