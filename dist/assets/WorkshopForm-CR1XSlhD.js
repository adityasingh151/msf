import{f as P,r as i,g as I,b as f,h as H,j as s,L as Y,E as Z,R as B,t as b,n as O,p as V,i as z,w as Q,l as G,m as J}from"./index-C1Md3IU_.js";import{u as K,C as y}from"./index.esm-CSBi2Yp2.js";import{B as X}from"./index-DZXT9Nwh.js";import{S as _}from"./Saving-5cbZdhLL.js";import{S as ee}from"./SuccessNotification-BG_7mmcG.js";const ie=()=>{const{register:d,handleSubmit:q,setValue:w,watch:E,formState:{errors:m},control:x}=K(),{workshopId:c}=P();i.useState(["headerTitle","aboutDescription","aboutImage","registrationLink"]);const l=E("aboutImage"),[S,u]=i.useState(),[F,k]=i.useState(!1),[L,g]=i.useState(!0),[T,j]=i.useState(!1),[v,h]=i.useState(!1),[r,N]=i.useState({headerSection:!0,reachSection:!1,outcomesSection:!1,quoteSection:!1,registrationSection:!1});i.useEffect(()=>{if(c){const e=I(),o=f(e,`workshops/${c}`);H(o).then(t=>{if(t.exists()){const a=t.val();Object.keys(a).forEach(n=>{w(n,a[n])}),u(a.aboutImage)}g(!1)}).catch(t=>{console.error("Error fetching workshop data: ",t),h(!0),g(!1)})}else g(!1)},[c,w]),i.useEffect(()=>{if(l&&l.length>0&&typeof l[0]=="object"){const e=new FileReader;e.onload=o=>u(o.target.result),e.readAsDataURL(l[0])}},[l]);const C=async(e,o)=>{const t=z(Q,o);return await G(t,e),await J(t)},U=e=>{const o=/<iframe.*?src=".*?\/embed\?pb=(.*?)".*?><\/iframe>/,t=e.match(o);return t?t[1]:e},$=async e=>{k(!0);try{let o=e.aboutImage;e.aboutImage&&e.aboutImage[0]instanceof File&&(o=await C(e.aboutImage[0],`workshops/${e.aboutImage[0].name}`));const t=r.reachSection?U(e.addressURL):"",a={...r.headerSection&&{headerTitle:e.headerTitle||"",aboutDescription:e.aboutDescription||"",aboutImage:o||"",registrationLink:e.registrationLink||""},...r.reachSection&&{address:e.address||"",addressURL:t||""},...r.outcomesSection&&{outcomeContent:e.outcomeContent||""},...r.quoteSection&&{quote:e.quote||""},...r.registrationSection&&{workshopDate:e.workshopDate?b(e.workshopDate).format("DD MMMM, YYYY"):"",workshopStartTime:e.workshopStartTime?b(e.workshopStartTime,"HH:mm").format("hh:mm A"):"",workshopEndTime:e.workshopEndTime?b(e.workshopEndTime,"HH:mm").format("hh:mm A"):"",prerequisites:e.prerequisites||"",designedFor:e.designedFor||"",lastDateForRegistration:e.lastDateForRegistration||"",workshopRegistrationFee:e.workshopRegistrationFee||""}},n=I();c?(console.log(a),await O(f(n,`workshops/${c}`),a)):(console.log(a),await V(f(n,"workshops"),a)),j(!0)}catch(o){console.error("Error adding/updating workshop data:",o),h(!0)}finally{k(!1)}},A=e=>{N(o=>({...o,[e]:!o[e]}))};i.useEffect(()=>{d("aboutImage",{required:r.headerSection&&"This field is required"})},[d,r.headerSection]);const W=e=>e.includes("Date")?"date":e.includes("Time")?"time":"text",R={headerSection:["headerTitle","aboutDescription","aboutImage","registrationLink"],reachSection:["address","addressURL"],outcomesSection:["outcomeContent"],quoteSection:["quote"],registrationSection:["workshopDate","workshopStartTime","workshopEndTime","prerequisites","designedFor","lastDateForRegistration","workshopRegistrationFee"]};return L?s.jsx(Y,{}):s.jsxs(s.Fragment,{children:[F&&s.jsx(_,{}),s.jsxs("div",{className:"flex flex-col sm:flex-row",children:[s.jsx("div",{className:"flex flex-col space-y-2 p-6 sm:w-1/3",children:Object.entries(R).map(([e,o])=>s.jsxs("button",{onClick:()=>A(e),className:`text-sm py-2 px-4 rounded transition duration-300 flex items-center gap-2 ${r[e]?"bg-red-500 hover:bg-red-700":"bg-blue-500 hover:bg-blue-700"} text-white`,children:[s.jsx(X,{})," ",r[e]?"Remove":"Add"," ",e.replace(/([A-Z])/g," $1").replace("Section"," Section")]},e))}),s.jsxs("form",{onSubmit:q($),className:"p-6 bg-white shadow-lg rounded-lg flex-grow space-y-4 w-full sm:w-2/3",children:[s.jsx("h2",{className:"text-2xl font-bold text-indigo-600",children:"Workshop Details"}),T&&s.jsx(ee,{message:c?"Workshop Updated Successfully!":"Workshop Created Successfully!",onClose:()=>j(!1)}),v&&s.jsx(Z,{message:"Something went wrong!",onClose:()=>h(!1)}),Object.entries(R).map(([e,o])=>r[e]&&o.map(t=>s.jsxs("div",{className:"relative",children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 capitalize",children:[t.replace(/([A-Z])/g," $1"),["headerSubtitle","outcomeContent","quote","prerequisites","designedFor","lastDateForRegistration","registrationLink"].includes(t)?null:s.jsx("span",{className:"text-red-500",children:"*"})]}),t==="aboutImage"?s.jsx(y,{name:"aboutImage",control:x,defaultValue:"",rules:{required:r.headerSection&&"This field is required"},render:({field:{onChange:a,value:n}})=>s.jsxs("div",{children:[s.jsx("input",{type:"file",onChange:p=>{if(a(p.target.files),p.target.files.length>0){const D=new FileReader;D.onload=M=>u(M.target.result),D.readAsDataURL(p.target.files[0])}else u(null)},className:"mt-1 block w-full pl-3 py-2 text-sm text-gray-900 border border-gray-300 rounded-md shadow-sm cursor-pointer focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"}),S&&s.jsx("img",{src:S,alt:"Preview",className:"mt-4 h-48 w-auto border rounded-md mx-auto"})]})}):["aboutDescription","registrationLink","address","addressURL","outcomeContent","quote","prerequisites","designedFor","lastDateForRegistration"].includes(t)?s.jsx(y,{name:t,control:x,defaultValue:"",rules:{required:["headerTitle","aboutDescription","aboutImage"].includes(t)?r.headerSection&&"This field is required":!1},render:({field:{onChange:a,value:n}})=>s.jsx(B,{value:n,onChange:a,placeholder:`Enter ${t.replace(/([A-Z])/g," $1")}`})}):s.jsx("input",{type:W(t),...d(t,{required:["headerTitle","aboutDescription","aboutImage"].includes(t)?r.headerSection&&"This field is required":!1,minLength:{value:t.includes("Fee")?0:3,message:"Minimum length is 3 characters"}}),className:`mt-1 block w-full pl-3 pr-12 py-2 border ${m[t]?"border-red-500":"border-gray-300"} rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500`,placeholder:`Enter ${t.replace(/([A-Z])/g," $1")}`}),m[t]&&s.jsx("p",{className:"mt-1 text-sm text-red-500",children:m[t].message})]},t))),s.jsx("button",{type:"submit",className:"w-full bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded",children:c?"Update Workshop Details":"Submit Workshop Details"})]})]})]})};export{ie as default};
