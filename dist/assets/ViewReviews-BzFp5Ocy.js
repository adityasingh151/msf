import{r as i,g as p,b as w,j as e,L as V,E as A,o as T,e as B,n as P,k as _,i as z,l as G,m as H}from"./index-C1Md3IU_.js";import{u as J}from"./index.esm-CSBi2Yp2.js";import{S as K}from"./SuccessNotification-BG_7mmcG.js";import{S as Q}from"./Saving-5cbZdhLL.js";import{M as W}from"./Modal-DhpaDZAq.js";const te=()=>{const[m,g]=i.useState([]),[k,v]=i.useState(!0),[E,o]=i.useState(!1),[D,n]=i.useState(!1),[U,u]=i.useState(!1),[t,j]=i.useState(null),[y,x]=i.useState(null),[C,d]=i.useState(!1),[N,S]=i.useState(null),{register:f,handleSubmit:L,setValue:b,formState:{errors:l}}=J();i.useEffect(()=>{const s=p(),a=w(s,"reviews");(()=>{T(a,r=>{if(r.exists()){const h=r.val(),O=Object.keys(h).map(R=>({id:R,...h[R]}));g(O)}else console.log("No data available"),o(!0);v(!1)},r=>{console.error("Error fetching reviews: ",r),o(!0),v(!1)})})()},[]);const I=s=>{j(s),b("name",s.name),b("review",s.review),b("designation",s.designation),x(null)},$=s=>{S(s),d(!0)},M=async()=>{try{n(!0);const s=w(p(),`reviews/${N.id}`);await B(s),g(m.filter(a=>a.id!==N.id)),u(!0)}catch(s){console.error("Error deleting review: ",s),o(!0)}finally{n(!1),d(!1),S(null)}},q=async s=>{const a=_(),c=`review_images/${s.name}`,r=z(a,c);return await G(r,s),await H(r)},F=async s=>{n(!0);try{let a=t==null?void 0:t.imageUrl;y&&(a=await q(y));const c=w(p(),`reviews/${t.id}`);await P(c,{name:s.name,review:s.review,designation:s.designation,imageUrl:a||(t==null?void 0:t.imageUrl)}),g(m.map(r=>r.id===t.id?{id:t.id,...s,imageUrl:a}:r)),u(!0),j(null),x(null)}catch(a){console.error("Error updating review: ",a),o(!0)}finally{n(!1)}};return k?e.jsx(V,{}):E?e.jsx(A,{message:"Failed to load reviews!",onClose:()=>o(!1)}):e.jsxs("section",{className:"bg-gray-50",children:[e.jsxs("div",{className:"mx-auto max-w-[1340px] px-4 py-12 sm:px-6 lg:me-0 lg:py-16 lg:pe-0 lg:ps-8 xl:py-24",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl",children:"Manage Reviews"}),e.jsxs("div",{className:"grid grid-cols-1 gap-8 lg:grid-cols-3 lg:items-center lg:gap-16 mt-6",children:[e.jsx("div",{className:"lg:col-span-2",children:m.map(s=>e.jsx("div",{className:"p-6 bg-white shadow-lg rounded-lg mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-rose-600",children:s.name}),e.jsx("p",{className:"text-gray-500",children:s.designation}),e.jsx("p",{className:"mt-4 text-gray-700",children:s.review}),s.imageUrl&&e.jsx("img",{src:s.imageUrl,alt:"Reviewer",className:"w-32 h-32 object-cover mt-4 rounded-full"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>I(s),className:"bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-700",children:"Edit"}),e.jsx("button",{onClick:()=>$(s),className:"bg-red-500 text-white font-bold py-2 px-4 rounded hover:bg-red-700",children:"Delete"})]})]})},s.id))}),e.jsxs("div",{className:"bg-white p-6 shadow-lg rounded-lg",children:[e.jsx("h3",{className:"text-2xl font-bold text-indigo-600 mb-4",children:t?"Edit Review":"Add New Review"}),D&&e.jsx(Q,{}),U&&e.jsx(K,{message:"Review saved successfully!",onClose:()=>u(!1)}),e.jsxs("form",{onSubmit:L(F),className:"space-y-4",children:[e.jsx("div",{children:e.jsxs("label",{className:"block text-base font-medium text-gray-700",children:["Reviewer's Name ",e.jsx("span",{className:"text-red-500",children:"*"}),e.jsx("input",{type:"text",...f("name",{required:"Name is required"}),className:`mt-1 block w-full pl-3 py-2 text-base text-gray-900 border ${l.name?"border-red-500":"border-gray-300"} rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500`}),l.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.name.message})]})}),e.jsx("div",{children:e.jsxs("label",{className:"block text-base font-medium text-gray-700",children:["Review ",e.jsx("span",{className:"text-red-500",children:"*"}),e.jsx("textarea",{...f("review",{required:"Review is required"}),className:`mt-1 block w-full pl-3 py-2 text-base text-gray-900 border ${l.review?"border-red-500":"border-gray-300"} rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500`}),l.review&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.review.message})]})}),e.jsx("div",{children:e.jsxs("label",{className:"block text-base font-medium text-gray-700",children:["Reviewer's Designation",e.jsx("input",{type:"text",...f("designation"),className:"mt-1 block w-full pl-3 py-2 text-base text-gray-900 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]})}),e.jsx("div",{children:e.jsxs("label",{className:"block text-base font-medium text-gray-700",children:["Reviewer's Image",e.jsx("input",{type:"file",onChange:s=>x(s.target.files[0]),className:"mt-1 block w-full text-gray-900 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]})}),e.jsx("button",{type:"submit",className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded",children:t?"Update Review":"Submit Review"})]})]})]})]}),e.jsxs(W,{isOpen:C,title:"Delete Review",onClose:()=>d(!1),children:[e.jsx("p",{children:"Are you sure you want to delete this review?"}),e.jsxs("div",{className:"flex justify-end mt-4 gap-4",children:[e.jsx("button",{onClick:()=>d(!1),className:"bg-gray-300 hover:bg-gray-400 text-black py-2 px-4 rounded",children:"Cancel"}),e.jsx("button",{onClick:M,className:"bg-red-500 hover:bg-red-700 text-white py-2 px-4 rounded",children:"Delete"})]})]})]})};export{te as default};
